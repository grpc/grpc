<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC Objective-C: Keepalive User Guide for gRPC Core (and dependents)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC Objective-C
   &#160;<span id="projectnumber">1.50.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Keepalive User Guide for gRPC Core (and dependents) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The keepalive ping is a way to check if a channel is currently working by sending HTTP2 pings over the transport. It is sent periodically, and if the ping is not acknowledged by the peer within a certain timeout period, the transport is disconnected.</p>
<p>This guide documents the knobs within gRPC core to control the current behavior of the keepalive ping.</p>
<p>The keepalive ping in core is controlled by the following channel arguments -</p>
<ul>
<li><b>GRPC_ARG_KEEPALIVE_TIME_MS</b><ul>
<li>This channel argument controls the period (in milliseconds) after which a keepalive ping is sent on the transport.</li>
</ul>
</li>
<li><b>GRPC_ARG_KEEPALIVE_TIMEOUT_MS</b><ul>
<li>This channel argument controls the amount of time (in milliseconds) the sender of the keepalive ping waits for an acknowledgement. If it does not receive an acknowledgment within this time, it will close the connection.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA</b><ul>
<li>This channel argument controls the maximum number of pings that can be sent when there is no data/header frame to be sent. gRPC Core will not continue sending pings if we run over the limit. Setting it to 0 allows sending pings without such a restriction. (Note that this is an unfortunate setting that does not agree with <a href="https://github.com/grpc/proposal/blob/master/A8-client-side-keepalive.md">A8-client-side-keepalive.md</a>. There should ideally be no such restriction on the keepalive ping and we plan to deprecate it in the future.)</li>
</ul>
</li>
<li><b>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</b><ul>
<li>This channel argument if set to 1 (0 : false; 1 : true), allows keepalive pings to be sent even if there are no calls in flight.</li>
</ul>
</li>
</ul>
<p>On the server-side, the following additional channel arguments need to be configured -</p>
<ul>
<li><b>GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS</b><ul>
<li>If there are no data/header frames being sent on the transport, this channel argument on the server side controls the minimum time (in milliseconds) that gRPC Core would expect between receiving successive pings. If the time between successive pings is less that than this time, then the ping will be considered a bad ping from the peer. Such a ping counts as a ‘ping strike’. On the client side, this does not have any effect.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MAX_PING_STRIKES</b><ul>
<li>This arg controls the maximum number of bad pings that the server will tolerate before sending an HTTP2 GOAWAY frame and closing the transport. Setting it to 0 allows the server to accept any number of bad pings.</li>
</ul>
</li>
</ul>
<p><b>IMPORTANT NOTE</b> - For keepalive to work properly and as intended, all of the above channel arguments should be configured appropriately. The client-side keepalive settings should also be in agreement with the server-side settings. If a client sends pings more often than the server is willing to accept, the connection will be terminated with a GOAWAY frame with "too_many_pings" as the debug data.</p>
<h2><a class="anchor" id="autotoc_md167"></a>
Defaults Values</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Channel Argument </th><th class="markdownTableHeadNone">Client </th><th class="markdownTableHeadNone">Server  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GRPC_ARG_KEEPALIVE_TIME_MS </td><td class="markdownTableBodyNone">INT_MAX (disabled) </td><td class="markdownTableBodyNone">7200000 (2 hours)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GRPC_ARG_KEEPALIVE_TIMEOUT_MS </td><td class="markdownTableBodyNone">20000 (20 seconds) </td><td class="markdownTableBodyNone">20000 (20 seconds)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS </td><td class="markdownTableBodyNone">0 (false) </td><td class="markdownTableBodyNone">0 (false)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA </td><td class="markdownTableBodyNone">2 </td><td class="markdownTableBodyNone">2  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS </td><td class="markdownTableBodyNone">N/A </td><td class="markdownTableBodyNone">300000 (5 minutes)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">GRPC_ARG_HTTP2_MAX_PING_STRIKES </td><td class="markdownTableBodyNone">N/A </td><td class="markdownTableBodyNone">2  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md168"></a>
FAQ</h2>
<ul>
<li>When is the keepalive timer started?<ul>
<li>The keepalive timer is started when a transport is done connecting (after handshake).</li>
</ul>
</li>
<li>What happens when the keepalive timer fires?<ul>
<li>When the keepalive timer fires, gRPC Core will try to send a keepalive ping on the transport. This ping can be blocked if -<ul>
<li>there is no active call on that transport and <code>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</code> is false.</li>
<li>the number of pings already sent on the transport without any data has already exceeded <code>GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA</code>.</li>
</ul>
</li>
<li>If a keepalive ping is not blocked and is sent on the transport, then the keepalive watchdog timer is started which will close the transport if the ping is not acknowledged before it fires.</li>
</ul>
</li>
<li>Why am I receiving a GOAWAY with error code <code>ENHANCE_YOUR_CALM</code>?<ul>
<li>A server sends a GOAWAY with <code>ENHANCE_YOUR_CALM</code> if the client sends too many misbehaving pings as described in <a href="https://github.com/grpc/proposal/blob/master/A8-client-side-keepalive.md">A8-client-side-keepalive.md</a>. Some scenarios where this can happen are -<ul>
<li>if a server has <code>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</code> set to false while the client has set this to true resulting in keepalive pings being sent even when there is no call in flight.</li>
<li>if the client's <code>GRPC_ARG_KEEPALIVE_TIME_MS</code> setting is lower than the server's <code>GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Why is my client not sending keepalive pings even after configuring <code>GRPC_ARG_KEEPALIVE_TIME_MS</code> and <code>GRPC_ARG_KEEPALIVE_TIMEOUT_MS</code>?<ul>
<li>This can happen in the following cases -<ul>
<li>There are no RPCs in flight and <code>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</code> has not been set to 1(defaults to 0). If we require the endpoint to be able to send pings even when there are no ongoing RPCs, <code>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</code> should be set to 1 as documented above.</li>
<li>When there isn't any data/header being sent on the transport, gRPC clients restrict the number of pings to 2 by default. Setting <code>GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA</code> to 0 will remove this limit. </li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 14 2022 17:25:10 for GRPC Objective-C by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
