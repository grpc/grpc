<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC Objective-C: gRPC Server Reflection Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC Objective-C
   &#160;<span id="projectnumber">1.58.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">gRPC Server Reflection Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>gRPC Server Reflection provides information about publicly-accessible gRPC services on a server, and assists clients at runtime to construct RPC requests and responses without precompiled service information. It is used by gRPC CLI, which can be used to introspect server protos and send/receive test RPCs.</p>
<h1><a class="anchor" id="autotoc_md202"></a>
Enable Server Reflection</h1>
<h2><a class="anchor" id="autotoc_md203"></a>
Enable server reflection in C++ servers</h2>
<p>C++ Server Reflection is an add-on library, <code>libgrpc++_reflection</code>. To enable C++ server reflection, you can link this library to your server binary.</p>
<p>Some platforms (e.g. Ubuntu 11.10 onwards) only link in libraries that directly contain symbols used by the application. On these platforms, LD flag <code>--no-as-needed</code> is needed for dynamic linking and <code>--whole-archive</code> is needed for static linking.</p>
<p>This <a href="../examples/cpp/helloworld/Makefile#L37#L45">Makefile</a> demonstrates enabling c++ server reflection on Linux and MacOS.</p>
<h1><a class="anchor" id="autotoc_md204"></a>
Test services using Server Reflection</h1>
<p>After enabling Server Reflection in a server application, you can use gRPC CLI to test its services.</p>
<p>Instructions on how to use gRPC CLI can be found at <a class="el" href="command__line__tool_8md.html">command_line_tool.md</a>, or using <code>grpc_cli help</code> command.</p>
<p>Here we use <code>examples/cpp/helloworld</code> as an example to show the use of gRPC Server Reflection and gRPC CLI. First, we need to build gRPC CLI and setup an example server with Server Reflection enabled.</p>
<ul>
<li><p class="startli">Setup an example server</p>
<p class="startli">Server Reflection has already been enabled in the <a href="../examples/cpp/helloworld/Makefile">Makefile</a> of the helloworld example. We can simply make it and run the greeter_server.</p>
</li>
</ul>
<div class="fragment"><div class="line">$ make -C examples/cpp/helloworld</div>
<div class="line">$ examples/cpp/helloworld/greeter_server &amp;</div>
</div><!-- fragment --><ul>
<li>Build gRPC CLI</li>
</ul>
<div class="fragment"><div class="line">make grpc_cli</div>
<div class="line">cd bins/opt</div>
</div><!-- fragment --><p>gRPC CLI binary <code>grpc_cli</code> can be found at <code>bins/opt/</code> folder. This tool is still new and does not have a <code>make install</code> target yet.</p>
<h2><a class="anchor" id="autotoc_md205"></a>
List services</h2>
<p><code>grpc_cli ls</code> command lists services and methods exposed at a given port</p>
<ul>
<li>List all the services exposed at a given port</li>
</ul>
<div class="fragment"><div class="line">$ grpc_cli ls localhost:50051</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">helloworld.Greeter</div>
<div class="line">grpc.reflection.v1alpha.ServerReflection</div>
</div><!-- fragment --><ul>
<li><p class="startli">List one service with details</p>
<p class="startli"><code>grpc_cli ls</code> command inspects a service given its full name (in the format of &lt;package&gt;.&lt;service&gt;). It can print information with a long listing format when <code>-l</code> flag is set. This flag can be used to get more details about a service.</p>
</li>
</ul>
<div class="fragment"><div class="line">$ grpc_cli ls localhost:50051 helloworld.Greeter -l</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">filename: helloworld.proto</div>
<div class="line">package: helloworld;</div>
<div class="line">service Greeter {</div>
<div class="line">  rpc SayHello(helloworld.HelloRequest) returns (helloworld.HelloReply) {}</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md206"></a>
List methods</h2>
<ul>
<li><p class="startli">List one method with details</p>
<p class="startli"><code>grpc_cli ls</code> command also inspects a method given its full name (in the format of &lt;package&gt;.&lt;service&gt;.&lt;method&gt;).</p>
</li>
</ul>
<div class="fragment"><div class="line">$ grpc_cli ls localhost:50051 helloworld.Greeter.SayHello -l</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">rpc SayHello(helloworld.HelloRequest) returns (helloworld.HelloReply) {}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md207"></a>
Inspect message types</h2>
<p>We can use<code>grpc_cli type</code> command to inspect request/response types given the full name of the type (in the format of &lt;package&gt;.&lt;type&gt;).</p>
<ul>
<li>Get information about the request type</li>
</ul>
<div class="fragment"><div class="line">$ grpc_cli type localhost:50051 helloworld.HelloRequest</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">message HelloRequest {</div>
<div class="line">  optional string name = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md208"></a>
Call a remote method</h2>
<p>We can send RPCs to a server and get responses using <code>grpc_cli call</code> command.</p>
<ul>
<li>Call a unary method</li>
</ul>
<div class="fragment"><div class="line">$ grpc_cli call localhost:50051 SayHello &quot;name: &#39;gRPC CLI&#39;&quot;</div>
</div><!-- fragment --><p>output: </p><div class="fragment"><div class="line">message: &quot;Hello gRPC CLI&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md209"></a>
Use Server Reflection in a C++ client</h1>
<p>Server Reflection can be used by clients to get information about gRPC services at runtime. We've provided a descriptor database called <a href="../test/cpp/util/proto_reflection_descriptor_database.h">grpc::ProtoReflectionDescriptorDatabase</a> which implements the <a href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor_database#DescriptorDatabase">google::protobuf::DescriptorDatabase</a> interface. It manages the communication between clients and reflection services and the storage of received information. Clients can use it as using a local descriptor database.</p>
<ul>
<li>To use Server Reflection with grpc::ProtoReflectionDescriptorDatabase, first initialize an instance with a grpc::Channel.</li>
</ul>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> std::shared_ptr&lt;grpc::Channel&gt; channel =</div>
<div class="line">     grpc::CreateChannel(server_address, server_cred);</div>
<div class="line"> grpc::ProtoReflectionDescriptorDatabase reflection_db(channel);</div>
</div><!-- fragment --><ul>
<li>Then use this instance to feed a <a href="https://developers.google.com/protocol-buffers/docs/reference/cpp/google.protobuf.descriptor#DescriptorPool">google::protobuf::DescriptorPool</a>.</li>
</ul>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> google::protobuf::DescriptorPool desc_pool(&amp;reflection_db);</div>
</div><!-- fragment --><ul>
<li>Example usage of this descriptor pool<ul>
<li><p class="startli">Get Service/method descriptors.</p>
<p class="startli">```c++ const google::protobuf::ServiceDescriptor* service_desc = desc_pool-&gt;FindServiceByName("helloworld.Greeter"); const google::protobuf::MethodDescriptor* method_desc = desc_pool-&gt;FindMethodByName("helloworld.Greeter.SayHello"); ```</p>
</li>
<li><p class="startli">Get message type descriptors and create messages dynamically.</p>
<p class="startli">```c++ const google::protobuf::Descriptor* request_desc = desc_pool-&gt;FindMessageTypeByName("helloworld.HelloRequest"); google::protobuf::DynamicMessageFactory dmf; google::protobuf::Message* request = dmf.GetPrototype(request_desc)-&gt;New(); ```</p>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md210"></a>
Use Server Reflection in a Python client</h1>
<p>See Python Server Reflection. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 6 2023 16:09:46 for GRPC Objective-C by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
