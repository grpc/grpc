<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC Core: Default HTTP Proxy Mapper User Guide for gRPC Core (and dependents)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC Core
   &#160;<span id="projectnumber">35.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Default HTTP Proxy Mapper User Guide for gRPC Core (and dependents) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/grpc/proposal/blob/master/A1-http-connect-proxy-support.md">A1-http-connect-proxy-support.md</a> proposed how gRPC supports TCP-level proxies via the HTTP CONNECT request, defined in <a href="https://www.rfc-editor.org/rfc/rfc2817">RFC-2817</a>.</p>
<p><b>Case 1</b> in the proposal documents a use-case where all outbound traffic from an environment must go through a proxy. Configurations for such environments are usually performed using environment variables such as <code>http_proxy</code>. gRPC supports this by providing a default proxy mapper implementation that allows for overriding the server name (provided in the channel creation hostname) to resolve based on such configurations.</p>
<p>This guide documents gRPC C-Core's default proxy mapper implementation.</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Working</h1>
<h2><a class="anchor" id="autotoc_md88"></a>
Enabling HTTP Proxy</h2>
<p>C-Core checks the following places to determine the HTTP proxy to use, stopping at the first one that is set:</p>
<ol type="1">
<li><code>GRPC_ARG_HTTP_PROXY</code> channel arg</li>
<li><code>grpc_proxy</code> environment variable</li>
<li><code>https_proxy</code> environment variable</li>
<li><code>http_proxy</code> environment variable</li>
</ol>
<p>If none of the above are set, then no HTTP proxy will be used.</p>
<p>The allowed format is an <a href="https://www.rfc-editor.org/rfc/rfc3986">RFC3986</a> URI string where the scheme is expected to be "http" and the authority portion is used to determine the proxy to be used. For example, for an HTTP proxy setting of <code><a href="http://username:password">http://username:password</a>@proxy.google.com:443</code>, <code>username:password</code> would be used as user credentials for proxy authentication as per <a href="https://www.rfc-editor.org/rfc/rfc7617">RFC7617</a> and <code>proxy.google.com:443</code> would be the host:port HTTP proxy target. If the port part of the authority is omitted, a default port of 443 is used. Note that user credential can also be omitted if the proxy does not need authentication.</p>
<h2><a class="anchor" id="autotoc_md89"></a>
Disabling HTTP Proxy</h2>
<p>If an HTTP proxy is set, C-Core then checks the following places to exclude traffic destined to listed hosts from going through the proxy determined above, again stopping at the first one that is set:</p>
<ol type="1">
<li><code>no_grpc_proxy</code> environment variable</li>
<li><code>no_proxy</code>environment variable</li>
</ol>
<p>If none of the above are set, then the previously found HTTP proxy is used.</p>
<p>The format takes a comma-separated list of names, and if any of these names matches as a suffix of the server host (provided in the channel target), then the proxy will not be used for that target. For example, with a <code>grpc_proxy</code> setting of <code>proxy.google.com</code> and a <code>no_grpc_proxy</code> setting of <code>example.com, google.com</code>, channel targets such as <code>dns:///foo.google.com:50051</code> and <code>bar.example.com:1234</code> will not use the proxy, but <code>baz.googleapis.com:443</code> would still use the configured proxy <code>proxy.google.com</code>.</p>
<p>As of <a href="https://github.com/grpc/grpc/pull/31119">PR#31119</a>, CIDR blocks are also supported in the list of names. For example, a <code>no_proxy</code> setting of <code>10.10.0.0/24</code> would not use the proxy for channel targets that mention IP addresses as the host between the range <code>10.10.0.0</code> to <code>10.10.0.255</code>.</p>
<h2><a class="anchor" id="autotoc_md90"></a>
Disabling HTTP Proxy Channel-wide</h2>
<p>The lookup and subsequent usage of an HTTP proxy for a specific channel can also be disabled by setting the channel arg <code>GRPC_ARG_ENABLE_HTTP_PROXY</code> to 0. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 6 2023 16:09:15 for GRPC Core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
