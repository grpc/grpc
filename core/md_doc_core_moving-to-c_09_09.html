<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC Core: Moving gRPC core to C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC Core
   &#160;<span id="projectnumber">24.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Moving gRPC core to C++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Originally written by ctiller, markdroth, and vjpai in October 2017</p>
<p>Revised by veblush in October 2019</p>
<h1><a class="anchor" id="autotoc_md127"></a>
Background and Goal</h1>
<p>gRPC core was originally written in C89 for several reasons (possibility of kernel integration, ease of wrapping, compiler support, etc). Over time, this was changed to C99 as all relevant compilers in active use came to support C99 effectively.</p>
<p>gRPC started allowing to use C++ with a couple of exceptions not to have C++ library linked such as <code>libstdc++.so</code>. (For more detail, see the <a href="https://github.com/grpc/proposal/blob/master/L6-core-allow-cpp.md">proposal</a>)</p>
<p>Finally gRPC became ready to use full C++11 with the standard library by the <a href="https://github.com[/grpc/proposal/blob/master/L59-core-allow-cppstdlib.md">proposal</a>.</p>
<p>Throughout all of these transitions, the public header files are committed to remain in C89.</p>
<p>The goal now is to make the gRPC core implementation true idiomatic C++ compatible with <a href="https://google.github.io/styleguide/cppguide.html">Google's C++ style guide</a>.</p>
<h1><a class="anchor" id="autotoc_md128"></a>
Constraints</h1>
<ul>
<li>Most of features available in C++11 are allowed to use but there are some exceptions because gRPC should support old systems.<ul>
<li>Should be built with gcc 4.8, clang 3.3, and Visual C++ 2015.</li>
<li>Should be run on Linux system with libstdc++ 6.0.9 to support <a href="https://www.python.org/dev/peps/pep-0513">manylinux1</a>.</li>
</ul>
</li>
<li>This would limit us not to use modern C++11 standard library such as <code>filesystem</code>. You can easily see whether PR is free from this issue by checking the result of <code>Artifact Build Linux</code> test.</li>
<li><code>thread_local</code> is not allowed to use on Apple's products because their old OSes (e.g. ios &lt; 9.0) don't support <code>thread_local</code>. Please use <code>GPR_TLS_DECL</code> instead.</li>
<li>gRPC main libraries (grpc, grpc+++, and plugins) cannot use following C++ libraries: (Test and example codes are relatively free from this constraints)<ul>
<li><code>&lt;thread&gt;</code>. Use <code>grpc_core::Thread</code>.</li>
<li><code>&lt;condition_variable&gt;</code>. Use <code>grpc_core::CondVar</code>.</li>
<li><code>&lt;mutex&gt;</code>. Use <code>grpc_core::Mutex</code>, <code>grpc_core::MutexLock</code>, and <code>grpc_core::ReleasableMutexLock</code>.</li>
<li><code>&lt;future&gt;</code></li>
<li><code>&lt;ratio&gt;</code></li>
<li><code>&lt;system_error&gt;</code></li>
<li><code>&lt;filesystem&gt;</code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md129"></a>
Roadmap</h1>
<ul>
<li>What should be the phases of getting code converted to idiomatic C++<ul>
<li>Opportunistically do leaf code that other parts don't depend on</li>
<li>Spend a little time deciding how to do non-leaf stuff that isn't central or polymorphic (e.g., timer, call combiner)</li>
<li>For big central or polymorphic interfaces, actually do an API review (for things like transport, filter API, endpoint, closure, exec_ctx, ...) .<ul>
<li>Core internal changes don't need a gRFC, but core surface changes do</li>
<li>But an API review should include at least a PR with the header change and tests to use it before it gets used more broadly</li>
</ul>
</li>
<li>iomgr polling for POSIX is a gray area whether it's a leaf or central</li>
</ul>
</li>
<li>What is the schedule?<ul>
<li>In Q4 2017, if some stuff happens opportunistically, great; otherwise ¯\_(ツ)_/¯</li>
<li>More updates as team time becomes available and committed to this project</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md130"></a>
Implications for C++ API and wrapped languages</h1>
<ul>
<li>For C++ structs, switch to <code>using</code> when possible (e.g., Slice, ByteBuffer, ...)</li>
<li>The C++ API implementation might directly start using <code>grpc_transport_stream_op_batch</code> rather than the core surface <code><a class="el" href="structgrpc__op.html" title="Operation data: one field for each op type (except SEND_CLOSE_FROM_CLIENT which has no arguments)">grpc_op</a></code>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 18 2022 17:42:13 for GRPC Core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
