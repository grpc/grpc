language: objective-c
osx_image: xcode7.3
env:
  global:
    - CONFIG=opt
    - TEST=objc
    - JOBS=1
  matrix:
    - TEST_PATH="src/objective-c/tests" WORKSPACE="Tests.xcworkspace" SCHEME="RxLibraryUnitTests" HAS_TEST=true
    - TEST_PATH="examples/objective-c/helloworld" WORKSPACE="HelloWorld.xcworkspace" SCHEME="HelloWorld" HAS_TEST=false
before_install:
  - pod --version
  - gem uninstall cocoapods -a
  - gem install cocoapods -v '1.0.0'
  - pod --version
  - brew install gflags
  - pushd third_party/protobuf
  - git checkout v3.0.0-beta-3
  - popd
install:
  - make grpc_objective_c_plugin
  - install bins/opt/grpc_objective_c_plugin /usr/local/bin/protoc-gen-objcgrpc
  - install bins/opt/protobuf/protoc /usr/local/bin/protoc
  - pushd $TEST_PATH
  - pod install
  - popd
before_script:
  - make interop_server
  - bins/$CONFIG/interop_server --port=5050 &
  - bins/$CONFIG/interop_server --port=5051 --use_tls &
xcode_workspace: "$TEST_PATH/$WORKSPACE"
xcode_scheme: "$SCHEME"
xcode_sdk: iphonesimulator9.3
notifications:
  email: false
