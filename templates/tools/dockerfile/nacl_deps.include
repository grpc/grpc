#===========================
# Native Client dependencies

# Needed for the Chrome dependency msttcorefonts
# http://askubuntu.com/questions/89096/how-do-i-enable-the-multiverse-repository
RUN echo 'deb http://archive.ubuntu.com/ubuntu/ trusty multiverse' >> /etc/apt/sources.list
RUN echo 'deb-src http://archive.ubuntu.com/ubuntu/ trusty multiverse' >> /etc/apt/sources.list
RUN echo 'deb http://archive.ubuntu.com/ubuntu/ trusty-updates multiverse' >> /etc/apt/sources.list
RUN echo 'deb-src http://archive.ubuntu.com/ubuntu/ trusty-updates multiverse' >> /etc/apt/sources.list
RUN echo 'deb http://archive.ubuntu.com/ubuntu/ trusty-security multiverse' >> /etc/apt/sources.list
RUN echo 'deb-src http://archive.ubuntu.com/ubuntu/ trusty-security multiverse' >> /etc/apt/sources.list
RUN apt-get update
RUN apt-get -y install msttcorefonts

# Download source
RUN git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
RUN mkdir chromium && cd chromium
RUN ../depot_tools/fetch --nohooks --no-history chromium
RUN cd src && ./build/install-build-deps.sh --nacl --no-prompt && cd ..

# Build NaCl toolchain
# The GYP_DEFINES is needed to install some ARM-specific tools necessary to
# build the SDK.
# https://chromium.googlesource.com/chromium/src/+/master/native_client_sdk/src/BUILDING.rst
RUN cd src/native_client_sdk/src
RUN GYP_DEFINES=target_arch=arm ../../../depot_tools/gclient runhooks
RUN build_tools/build_sdk.py
