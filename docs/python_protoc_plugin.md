# Standalone gRPC Python Protoc Plugin

This document describes how to build and use the standalone gRPC Python protoc plugin binary.

## Overview

The gRPC Python protoc plugin (`grpc_python_plugin` / `protoc-gen-grpc_python`) is a standalone binary that generates Python gRPC code from `.proto` files. Unlike the Python package `grpcio-tools` which requires a Python environment, this binary can be used on systems without Python installed.

## Building the Plugin

### Prerequisites

- C++17 compatible compiler
- CMake 3.16 or newer
- Protocol Buffers compiler and development libraries
- Abseil C++ libraries

### Build Instructions

#### Using CMake

```bash
# Create build directory
mkdir build && cd build

# Configure build (enable Python plugin)
cmake -DgRPC_BUILD_TESTS=OFF \
      -DCMAKE_BUILD_TYPE=Release \
      -DgRPC_BUILD_GRPC_PYTHON_PLUGIN=ON \
      ..

# Build the plugin
make grpc_python_plugin -j$(nproc)

# The binary will be at: build/grpc_python_plugin
```

#### Using Bazel

```bash
# Build the plugin
bazel build //src/compiler:grpc_python_plugin

# Build the protoc-compatible version
bazel build //src/compiler:protoc_gen_grpc_python

# The binary will be at: bazel-bin/src/compiler/grpc_python_plugin_native
```

#### Using Artifact Build Scripts

```bash
# Linux
ARTIFACTS_OUT=./artifacts tools/run_tests/artifacts/build_artifact_protoc_python.sh

# Windows
set ARTIFACTS_OUT=./artifacts
tools\\run_tests\\artifacts\\build_artifact_protoc_python.bat
```

## Installation

### Manual Installation

```bash
# Copy the binary to a directory in your PATH
cp build/grpc_python_plugin /usr/local/bin/
cp build/grpc_python_plugin /usr/local/bin/protoc-gen-grpc_python

# Or create a symlink
ln -s /path/to/grpc_python_plugin /usr/local/bin/protoc-gen-grpc_python
```

### Using CMake Install

```bash
cd build
make install

# This will install both grpc_python_plugin and create protoc-gen-grpc_python symlink
```

## Usage

Once installed, you can use the plugin with protoc in two ways:

### Method 1: Direct Plugin Path

```bash
protoc --plugin=protoc-gen-grpc_python=/path/to/grpc_python_plugin \
       --grpc_python_out=./output \
       --python_out=./output \
       service.proto
```

### Method 2: Plugin in PATH

If you have `protoc-gen-grpc_python` in your PATH:

```bash
protoc --grpc_python_out=./output \
       --python_out=./output \
       service.proto
```

## Generated Files

The plugin generates `*_pb2_grpc.py` files containing:

- Service stubs for clients
- Service interfaces for servers  
- Utility functions for gRPC service registration

Example for `helloworld.proto`:
- `helloworld_pb2.py` - Protocol buffer messages (generated by `--python_out`)
- `helloworld_pb2_grpc.py` - gRPC service code (generated by `--grpc_python_out`)

## Comparison with grpcio-tools

| Feature | Standalone Plugin | grpcio-tools |
|---------|-------------------|--------------|
| Python Required | ❌ No | ✅ Yes |
| Installation | Manual/Package Manager | `pip install grpcio-tools` |
| Usage | `protoc --grpc_python_out=.` | `python -m grpc_tools.protoc --grpc_python_out=.` |
| Distribution | Single binary | Python wheel |
| Dependencies | None (statically linked) | Python + protobuf package |

## Troubleshooting

### Plugin Not Found
```
protoc: --grpc_python_out: protoc-gen-grpc_python: Plugin not found or is not executable
```

**Solution**: Ensure `protoc-gen-grpc_python` is in your PATH or use the full path with `--plugin`.

### Missing Dependencies at Build Time

If you get build errors about missing dependencies:

1. **Install system packages** (Ubuntu/Debian):
   ```bash
   sudo apt install build-essential cmake libprotobuf-dev protobuf-compiler libabsl-dev
   ```

2. **Use package providers** in CMake:
   ```bash
   cmake -DgRPC_PROTOBUF_PROVIDER=package \
         -DgRPC_ABSL_PROVIDER=package \
         ..
   ```

3. **Use Docker build environment**:
   ```bash
   # Use official build containers
   docker run --rm -v $(pwd):/workspace grpc/tools:latest \
     /workspace/tools/run_tests/artifacts/build_artifact_protoc_python.sh
   ```

## Cross-Compilation

The plugin can be cross-compiled for different architectures:

```bash
# For ARM64
cmake -DCMAKE_TOOLCHAIN_FILE=path/to/aarch64-toolchain.cmake ..

# For Windows (using MinGW)
cmake -DCMAKE_TOOLCHAIN_FILE=path/to/mingw-toolchain.cmake ..
```

## Distribution

Pre-built binaries are available through:

- **GitHub Releases**: Download from gRPC releases
- **Package managers**: Available in various Linux distributions
- **Docker images**: Included in gRPC tooling containers

For the latest releases, see: https://github.com/grpc/grpc/releases