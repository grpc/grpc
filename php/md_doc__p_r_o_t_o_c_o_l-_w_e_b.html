<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC PHP: gRPC Web</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC PHP
   &#160;<span id="projectnumber">1.57.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">gRPC Web </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>gRPC-Web provides a JS client library that supports the same API as gRPC-Node to access a gRPC service. Due to browser limitation, the Web client library implements a different protocol than the <a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">native gRPC protocol</a>. This protocol is designed to make it easy for a proxy to translate between the protocols as this is the most likely deployment model.</p>
<p>This document lists the differences between the two protocols. To help tracking future revisions, this document describes a delta with the protocol details specified in the <a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">native gRPC protocol</a>.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Design goals</h1>
<p>For the gRPC-Web protocol, we have decided on the following design goals:</p>
<ul>
<li>adopt the same framing as “application/grpc” whenever possible</li>
<li>decouple from HTTP/2 framing which is not, and will never be, directly exposed by browsers</li>
<li>support text streams (e.g. base64) in order to provide cross-browser support (e.g. IE-10)</li>
</ul>
<p>While the new protocol will be published/reviewed publicly, we also intend to keep the protocol as an internal detail to gRPC-Web. More specifically, we expect the protocol to</p>
<ul>
<li>evolve over time, mainly to optimize for browser clients or support web-specific features such as CORS, XSRF</li>
<li>become optional (in 1-2 years) when browsers are able to speak the native gRPC protocol via the new <a href="https://github.com/whatwg/streams">whatwg streams API</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md18"></a>
Protocol differences vs @ref PROTOCOL-HTTP2.md "gRPC over HTTP2"</h1>
<p>Content-Type</p>
<ol type="1">
<li>application/grpc-web<ul>
<li>e.g. application/grpc-web+[proto, json, thrift]</li>
<li>the sender should always specify the message format, e.g. +proto, +json</li>
<li>the receiver should assume the default is "+proto" when the message format is missing in Content-Type (as "application/grpc-web")</li>
</ul>
</li>
<li>application/grpc-web-text<ul>
<li>text-encoded streams of “application/grpc-web”</li>
<li>e.g. application/grpc-web-text+[proto, thrift]</li>
</ul>
</li>
</ol>
<hr  />
<p>HTTP wire protocols</p>
<ol type="1">
<li>support any HTTP/*, with no dependency on HTTP/2 specific framing</li>
<li>header names may be upper- or mixed-case over HTTP/1.1, but trailers encoded in the last length-prefixed message must always use lower-case names.</li>
<li>use EOF (end of body) to close the stream</li>
</ol>
<hr  />
<p>HTTP/2 related behavior (specified in <a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">gRPC over HTTP2</a>)</p>
<ol type="1">
<li>stream-id is not supported or used</li>
<li>go-away is not supported or used</li>
</ol>
<hr  />
<p>Message framing (vs. <a href="PROTOCOL-HTTP2.md#http2-transport-mapping">http2-transport-mapping</a>)</p>
<ol type="1">
<li>Response status encoded as part of the response body<ul>
<li>Key-value pairs encoded as a HTTP/1 headers block (without the terminating newline), per <a href="https://tools.ietf.org/html/rfc7230#section-3.2">https://tools.ietf.org/html/rfc7230#section-3.2</a> <div class="fragment"><div class="line">key1: foo\r\n</div>
<div class="line">key2: bar\r\n</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>8th (MSB) bit of the 1st gRPC frame byte<ul>
<li>0: data</li>
<li>1: trailers <div class="fragment"><div class="line">10000000b: an uncompressed trailer (as part of the body)</div>
<div class="line">10000001b: a compressed trailer</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Trailers must be the last message of the response, as enforced by the implementation</li>
<li>Trailers-only responses: no change to the gRPC protocol spec. Trailers may be sent together with response headers, with no message in the body.</li>
</ol>
<hr  />
<p>User Agent</p>
<ul>
<li>Do NOT use User-Agent header (which is to be set by browsers, by default)</li>
<li>Use X-User-Agent: grpc-web-javascript/0.1 (follow the same format as specified in <a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">gRPC over HTTP2</a>)</li>
</ul>
<hr  />
<p>Text-encoded (response) streams</p>
<ol type="1">
<li>The client library should indicate to the server via the "Accept" header that the response stream needs to be text encoded e.g. when XHR is used or due to security policies with XHR<ul>
<li>Accept: application/grpc-web-text</li>
</ul>
</li>
<li>The default text encoding is base64<ul>
<li>Note that “Content-Transfer-Encoding: base64” should not be used. Due to in-stream base64 padding when delimiting messages, the entire response body is not necessarily a valid base64-encoded entity</li>
<li>While the server runtime will always base64-encode and flush gRPC messages atomically the client library should not assume base64 padding always happens at the boundary of message frames. That is, the implementation may send base64-encoded "chunks" with potential padding whenever the runtime needs to flush a byte buffer.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md24"></a>
Other features</h1>
<p>Retries, caching</p>
<ul>
<li>Will spec out the support after their respective gRPC spec extensions are finalized<ul>
<li>Safe retries: PUT</li>
<li>Caching: header encoded request and/or a web specific spec</li>
</ul>
</li>
</ul>
<hr  />
<p>Keep-alive</p>
<ul>
<li>HTTP/2 PING is not supported or used</li>
<li>Will not support send-beacon (GET)</li>
</ul>
<hr  />
<p>Bidi-streaming, with flow-control</p>
<ul>
<li>Pending on <a href="https://github.com/whatwg/fetch">whatwg fetch/streams</a> to be finalized and implemented in modern browsers</li>
<li>gRPC-Web client will support the native gRPC protocol with modern browsers</li>
</ul>
<hr  />
<p>Versioning</p>
<ul>
<li>Special headers may be introduced to support features that may break compatibility.</li>
</ul>
<hr  />
<p>Browser-specific features</p>
<ul>
<li>For features that are unique to browser or HTML clients, check the <a href="https://github.com/grpc/grpc-web/blob/master/doc/browser-features.md">spec doc</a> published in the grpc/grpc-web repo. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 14 2023 18:27:50 for GRPC PHP by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
