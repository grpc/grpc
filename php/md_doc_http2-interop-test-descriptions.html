<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC PHP: Negative HTTP/2 Interop Test Case Descriptions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC PHP
   &#160;<span id="projectnumber">1.57.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Negative HTTP/2 Interop Test Case Descriptions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Client and server use <a href="../src/proto/grpc/testing/test.proto">test.proto</a>.</p>
<h1><a class="anchor" id="autotoc_md91"></a>
Server</h1>
<p>The code for the custom http2 server can be found <a href="https://github.com/grpc/grpc/tree/master/test/http2_test">here</a>. It is responsible for handling requests and sending responses, and also for fulfilling the behavior of each particular test case.</p>
<p>Server should accept these arguments:</p><ul>
<li>&ndash;port=PORT<ul>
<li>The port the server will run on. For example, "8080"</li>
</ul>
</li>
<li>&ndash;test_case=TESTCASE<ul>
<li>The name of the test case to execute. For example, "goaway"</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md92"></a>
Client</h1>
<p>Clients implement test cases that test certain functionality. Each client is provided the test case it is expected to run as a command-line parameter. Names should be lowercase and without spaces.</p>
<p>Clients should accept these arguments:</p><ul>
<li>&ndash;server_host=HOSTNAME<ul>
<li>The server host to connect to. For example, "localhost" or "127.0.0.1"</li>
</ul>
</li>
<li>&ndash;server_port=PORT<ul>
<li>The server port to connect to. For example, "8080"</li>
</ul>
</li>
<li>&ndash;test_case=TESTCASE<ul>
<li>The name of the test case to execute. For example, "goaway"</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md93"></a>
Note</h1>
<p>Note that the server and client must be invoked with the same test case or else the test will be meaningless. For convenience, we provide a shell script wrapper that invokes both server and client at the same time, with the same test_case. This is the preferred way to run these tests.</p>
<h1><a class="anchor" id="autotoc_md94"></a>
Test Cases</h1>
<h2><a class="anchor" id="autotoc_md95"></a>
goaway</h2>
<p>This test verifies that the client correctly responds to a goaway sent by the server. The client should handle the goaway by switching to a new stream without the user application having to do a thing.</p>
<p>Client Procedure:</p><ol type="1">
<li><p class="startli">Client sends two UnaryCall requests (and sleeps for 1 second in-between). TODO: resolve <a href="https://github.com/grpc/grpc/issues/9300">9300</a> and remove the 1 second sleep</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>Both calls are successful.</li>
<li>Response payload body is 314159 bytes in size.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Server sends a GOAWAY after receiving the first UnaryCall.</li>
</ol>
<p>Server asserts:</p><ul>
<li>Two different connections were used from the client.</li>
</ul>
<h2><a class="anchor" id="autotoc_md96"></a>
rst_after_header</h2>
<p>This test verifies that the client fails correctly when the server sends a RST_STREAM immediately after sending headers to the client.</p>
<p>Procedure:</p><ol type="1">
<li><p class="startli">Client sends UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>Call was not successful.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Server sends a RST_STREAM with error code 0 after sending headers to the client.</li>
</ol>
<p><em>At the moment the error code and message returned are not standardized throughout all languages. Those checks will be added once all client languages behave the same way. <a href="https://github.com/grpc/grpc/issues/9142">#9142</a> is in flight.</em></p>
<h2><a class="anchor" id="autotoc_md97"></a>
rst_during_data</h2>
<p>This test verifies that the client fails "correctly" when the server sends a RST_STREAM halfway through sending data to the client.</p>
<p>Procedure:</p><ol type="1">
<li><p class="startli">Client sends UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>Call was not successful.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Server sends a RST_STREAM with error code 0 after sending half of the requested data to the client.</li>
</ol>
<h2><a class="anchor" id="autotoc_md98"></a>
rst_after_data</h2>
<p>This test verifies that the client fails "correctly" when the server sends a RST_STREAM after sending all of the data to the client.</p>
<p>Procedure:</p><ol type="1">
<li><p class="startli">Client sends UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>Call was not successful.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Server sends a RST_STREAM with error code 0 after sending all of the data to the client.</li>
</ol>
<p><em>Certain client languages allow the data to be accessed even though a RST_STREAM was encountered. Once all client languages behave this way, checks will be added on the incoming data.</em></p>
<h2><a class="anchor" id="autotoc_md99"></a>
ping</h2>
<p>This test verifies that the client correctly acknowledges all pings it gets from the server.</p>
<p>Procedure:</p><ol type="1">
<li><p class="startli">Client sends UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>call was successful.</li>
<li>response payload body is 314159 bytes in size.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Server tracks the number of outstanding pings (i.e. +1 when it sends a ping, and -1 when it receives an ack from the client).</li>
<li>Server sends pings before and after sending headers, also before and after sending data.</li>
</ol>
<p>Server Asserts:</p><ul>
<li>Number of outstanding pings is 0 when the connection is lost.</li>
</ul>
<h2><a class="anchor" id="autotoc_md100"></a>
max_streams</h2>
<p>This test verifies that the client observes the MAX_CONCURRENT_STREAMS limit set by the server.</p>
<p>Client Procedure:</p><ol type="1">
<li>Client sends initial UnaryCall to allow the server to update its MAX_CONCURRENT_STREAMS settings.</li>
<li>Client concurrently sends 10 UnaryCalls.</li>
</ol>
<p>Client Asserts:</p><ul>
<li>All UnaryCalls were successful, and had the correct type and payload size.</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Sets MAX_CONCURRENT_STREAMS to one after the connection is made.</li>
</ol>
<p><em>The assertion that the MAX_CONCURRENT_STREAMS limit is upheld occurs in the http2 library we used.</em></p>
<h2><a class="anchor" id="autotoc_md101"></a>
data_frame_padding</h2>
<p>This test verifies that the client can correctly receive padded http2 data frames. It also stresses the client's flow control (there is a high chance that the sender will deadlock if the client's flow control logic doesn't correctly account for padding).</p>
<p>Client Procedure: (Note this is the same procedure as in the "large_unary" gRPC interop tests. Clients should use their "large_unary" gRPC interop test implementations.) Procedure:</p><ol type="1">
<li><p class="startli">Client calls UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>call was successful</li>
<li>response payload body is 314159 bytes in size</li>
<li>clients are free to assert that the response payload body contents are zero and comparing the entire response message against a golden response</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Reply to the client's request with a <code>SimpleResponse</code>, with a payload body length of <code>SimpleRequest.response_size</code>. But send it across specific http2 data frames as follows:<ul>
<li>Each http2 data frame contains a 5 byte payload and 255 bytes of padding.</li>
</ul>
</li>
</ol>
<ul>
<li>Note the 5 byte payload and 255 byte padding are partly arbitrary, and other numbers are also ok. With 255 bytes of padding for each 5 bytes of payload containing actual gRPC message, the 300KB response size will multiply into around 15 megabytes of flow control debt, which should stress flow control accounting.</li>
</ul>
<h2><a class="anchor" id="autotoc_md102"></a>
no_df_padding_sanity_test</h2>
<p>This test verifies that the client can correctly receive a series of small data frames. Note that this test is intentionally a slight variation of "data_frame_padding", with the only difference being that this test doesn't use data frame padding when the response is sent. This test is primarily meant to prove correctness of the http2 server implementation and highlight failures of the "data_frame_padding" test.</p>
<p>Client Procedure: (Note this is the same procedure as in the "large_unary" gRPC interop tests. Clients should use their "large_unary" gRPC interop test implementations.) Procedure:</p><ol type="1">
<li><p class="startli">Client calls UnaryCall with:</p>
<p class="startli">``` { response_size: 314159 payload:{ body: 271828 bytes of zeros } } ```</p>
</li>
</ol>
<p>Client asserts:</p><ul>
<li>call was successful</li>
<li>response payload body is 314159 bytes in size</li>
<li>clients are free to assert that the response payload body contents are zero and comparing the entire response message against a golden response</li>
</ul>
<p>Server Procedure:</p><ol type="1">
<li>Reply to the client's request with a <code>SimpleResponse</code>, with a payload body length of <code>SimpleRequest.response_size</code>. But send it across series of http2 data frames that contain 5 bytes of "payload" and zero bytes of "padding" (the padding flags on the data frames should not be set). </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 14 2023 18:27:50 for GRPC PHP by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
