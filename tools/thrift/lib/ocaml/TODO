Write interfaces
Clean up the code generator
Avoid capture properly instead of relying on the user not to use _


