<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC C++: Keepalive User Guide for gRPC Core (and dependants)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GRPC C++
   &#160;<span id="projectnumber">1.16.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Keepalive User Guide for gRPC Core (and dependants) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The keepalive ping is a way to check if a channel is currently working by sending HTTP2 pings over the transport. It is sent periodically, and if the ping is not acknowledged by the peer within a certain timeout period, the transport is disconnected.</p>
<p>This guide documents the knobs within gRPC core to control the current behavior of the keepalive ping.</p>
<p>The keepalive ping is controlled by two important channel arguments -</p><ul>
<li><b>GRPC_ARG_KEEPALIVE_TIME_MS</b><ul>
<li>This channel argument controls the period (in milliseconds) after which a keepalive ping is sent on the transport.</li>
</ul>
</li>
<li><b>GRPC_ARG_KEEPALIVE_TIMEOUT_MS</b><ul>
<li>This channel argument controls the amount of time (in milliseconds), the sender of the keepalive ping waits for an acknowledgement. If it does not receive an acknowledgement within this time, it will close the connection.</li>
</ul>
</li>
</ul>
<p>The above two channel arguments should be sufficient for most users, but the following arguments can also be useful in certain use cases.</p><ul>
<li><b>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</b><ul>
<li>This channel argument if set to 1 (0 : false; 1 : true), allows keepalive pings to be sent even if there are no calls in flight.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA</b><ul>
<li>This channel argument controls the maximum number of pings that can be sent when there is no other data (data frame or header frame) to be sent. GRPC Core will not continue sending pings if we run over the limit. Setting it to 0 allows sending pings without sending data.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MIN_SENT_PING_INTERVAL_WITHOUT_DATA_MS</b><ul>
<li>If there is no data being sent on the transport, this channel argument controls the minimum time (in milliseconds) gRPC Core will wait between successive pings.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS</b><ul>
<li>If there is no data being sent on the transport, this channel argument on the server side controls the minimum time (in milliseconds) that gRPC Core would expect between receiving successive pings. If the time between successive pings is less that than this time, then the ping will be considered a bad ping from the peer. Such a ping counts as a ‘ping strike’. On the client side, this does not have any effect.</li>
</ul>
</li>
<li><b>GRPC_ARG_HTTP2_MAX_PING_STRIKES</b><ul>
<li>This arg controls the maximum number of bad pings that the server will tolerate before sending an HTTP2 GOAWAY frame and closing the transport. Setting it to 0 allows the server to accept any number of bad pings.</li>
</ul>
</li>
</ul>
<h3>Defaults Values</h3>
<table class="doxtable">
<tr>
<th>Channel Argument</th><th>Client</th><th>Server  </th></tr>
<tr>
<td>GRPC_ARG_KEEPALIVE_TIME_MS</td><td>INT_MAX (disabled)</td><td>7200000 (2 hours) </td></tr>
<tr>
<td>GRPC_ARG_KEEPALIVE_TIMEOUT_MS</td><td>20000 (20 seconds)</td><td>20000 (20 seconds) </td></tr>
<tr>
<td>GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS</td><td>0 (false)</td><td>0 (false) </td></tr>
<tr>
<td>GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA</td><td>2</td><td>2 </td></tr>
<tr>
<td>GRPC_ARG_HTTP2_MIN_SENT_PING_INTERVAL_WITHOUT_DATA_MS</td><td>300000 (5 minutes)</td><td>300000 (5 minutes) </td></tr>
<tr>
<td>GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS</td><td>N/A</td><td>300000 (5 minutes) </td></tr>
<tr>
<td>GRPC_ARG_HTTP2_MAX_PING_STRIKES</td><td>N/A</td><td>2 </td></tr>
</table>
<h3>FAQ</h3>
<ul>
<li>When is the keepalive timer started?<ul>
<li>The keepalive timer is started when a transport is done connecting (after handshake).</li>
</ul>
</li>
<li>What happens when the keepalive timer fires?<ul>
<li>When the keepalive timer fires, gRPC Core would try to send a keepalive ping on the transport. This ping can be blocked if -<ul>
<li>there is no active call on that transport and GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS is false.</li>
<li>the number of pings already sent on the transport without any data has already exceeded GRPC_ARG_HTTP2_MAX_PINGS_WITHOUT_DATA.</li>
<li>the time expired since the previous ping is less than GRPC_ARG_HTTP2_MIN_SENT_PING_INTERVAL_WITHOUT_DATA_MS.</li>
</ul>
</li>
<li>If a keepalive ping is not blocked and is sent on the transport, then the keepalive watchdog timer is started which would close the transport if the ping is not acknowledged before it fires.</li>
</ul>
</li>
<li>Why am I receiving a GOAWAY with error code ENHANCE_YOUR_CALM?<ul>
<li>A server sends a GOAWAY with ENHANCE_YOUR_CALM if the client sends too many misbehaving pings. For example -<ul>
<li>if a server has GRPC_ARG_KEEPALIVE_PERMIT_WITHOUT_CALLS set to false, and the client sends pings without there being any call in flight.</li>
<li>if the client's GRPC_ARG_HTTP2_MIN_SENT_PING_INTERVAL_WITHOUT_DATA_MS setting is lower than the server's GRPC_ARG_HTTP2_MIN_RECV_PING_INTERVAL_WITHOUT_DATA_MS. </li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 18 2018 11:18:35 for GRPC C++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
